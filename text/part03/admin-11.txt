%FILE internal/admin-11.html
%LASTMOD
%KEY pgsql-admin11

%TITLE バックアップとアップグレード


%CHAPTER バックアップ

<p>
PostgreSQLは論理バックアップと物理バックアップ、どちらもサポートしています。
<br>
他のオープンソースRDBMS(MySQLなど)と異なり、
PostgreSQLは
<u>論理物理どちらのバックアップもテーブルのLOCKなどで他の処理を邪魔しません</u>。
通常の検索や更新を行いつつ、それらに全く影響を与えずにバックアップできます。これは運用上大きなアドバンテージです。
</p>

%SECTION 論理バックアップ

<p>
PostgreSQLは標準のダンプコマンドpg_dumpとpg_dumpall、およびリストアコマンドpg_restoreをサポートしています。
<br>
pg_dumpはデータベース単位のデータをダンプ、pg_dumpallは全データベースのデータを一度にダンプする違いがありますが、それ以外はほぼ同様の使い方をするので、本書ではpg_dumpコマンドのみ説明します([<3-12>]参照)。
</p>


<p>
リストアは比較的時間がかかる作業です。
本書では説明しませんが、高速にデータを読み込むツールpg_bulkloadが公開されています。
</p>
<pre>
http://pgbulkload.projects.postgresql.org/index_ja.html
</pre>

%SECTION 物理バックアップ

<p>
PostgreSQLの物理バックアップ手段であるベースバックアップとアーカイブログは、[<2-10>]と[<3-21>]で詳しく解説しています。
</p>

<p>
また、バージョン9.0からサポートされたレプリケーションは究極の物理バックアップ手段です。
詳細は[<2-11>]と[<3-22>]、[<3-23>]で解説しています。
</p>

%CHAPTER アップグレード
<p>
PostgreSQLのバージョンアップで、問題になるのがデータベースクラスタのアップグレードです。
</p>

<p>
PostgreSQLは比較的バージョン間の互換性が保たれているので、pg_dumpとpg_restoreでほぼ問題なくアップグレードできます。
しかし、巨大なデータベースクラスタのダンプやリストアは、非常に長い時間がかかる場合があります。
</p>

<p>
バージョン9.0から、非常に手軽かつ短時間でアップグレードを行うpg_upgradeコマンドが提供されました。
pg_upgradeはバージョン8.3以降のデータベースクラスタをバージョン9.0以降のPostgreSQLで使えるようにアップグレードします。
</p>

<p>
バージョン8.2以前のアップグレードはpg_dumpとリストアコマンドを使うのが一般的です。
</p>

